{% extends "base.html" %}

{% block title %}Database Schema - Maintenance Tracker{% endblock %}

{% block header_title %}Database Schema Viewer{% endblock %}

{% block content %}
<div class="schema-debug">
    <div class="card">
        <div class="card-header">
            <h3>Database Tables and Columns</h3>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-3">
                    <div class="nav flex-column nav-pills" id="v-pills-tab" role="tablist" aria-orientation="vertical">
                        {% for table_name, columns in tables.items() %}
                            <button class="nav-link {% if loop.first %}active{% endif %}" 
                                    id="table-{{ table_name }}-tab" 
                                    data-bs-toggle="pill" 
                                    data-bs-target="#table-{{ table_name }}" 
                                    type="button" 
                                    role="tab"
                                    aria-selected="{% if loop.first %}true{% else %}false{% endif %}">
                                {{ table_name }}
                            </button>
                        {% endfor %}
                    </div>
                </div>
                <div class="col-md-9">
                    <div class="tab-content" id="v-pills-tabContent">
                        {% for table_name, columns in tables.items() %}
                            <div class="tab-pane fade {% if loop.first %}show active{% endif %}" 
                                 id="table-{{ table_name }}" 
                                 role="tabpanel" 
                                 aria-labelledby="table-{{ table_name }}-tab">
                                <h4 class="mb-3">Table: {{ table_name }}</h4>
                                <div class="table-container">
                                    <table class="table">
                                        <thead>
                                            <tr>
                                                <th>Column Name</th>
                                                <th>Type</th>
                                                <th>Nullable</th>
                                                <th>Default</th>
                                                <th>Primary Key</th>
                                                <th>Foreign Key</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for column in columns %}
                                                <tr>
                                                    <td>{{ column.name }}</td>
                                                    <td>{{ column.type }}</td>
                                                    <td>
                                                        {% if column.nullable %}
                                                            <span class="status-badge status-warning">Yes</span>
                                                        {% else %}
                                                            <span class="status-badge status-info">No</span>
                                                        {% endif %}
                                                    </td>
                                                    <td>{{ column.default or '-' }}</td>
                                                    <td>
                                                        {% if column.primary_key %}
                                                            <span class="status-badge status-success">Yes</span>
                                                        {% else %}
                                                            <span class="status-badge status-secondary">No</span>
                                                        {% endif %}
                                                    </td>
                                                    <td>{{ column.foreign_key or '-' }}</td>
                                                </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .nav-pills .nav-link {
        border-radius: 0.375rem;
        padding: 0.75rem 1rem;
        margin-bottom: 0.5rem;
        color: var(--gray-700);
        background-color: var(--gray-100);
        font-weight: 500;
    }
    
    .nav-pills .nav-link.active {
        background-color: var(--primary-color);
        color: white;
    }
    
    .tab-pane {
        padding: 1rem 0;
    }
    
    .status-badge.status-secondary {
        background-color: rgba(100, 116, 139, 0.1);
        color: var(--gray-500);
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Simple tab functionality since we might not have Bootstrap's JS
        const tabButtons = document.querySelectorAll('.nav-link');
        const tabPanes = document.querySelectorAll('.tab-pane');
        
        tabButtons.forEach(button => {
            button.addEventListener('click', function() {
                // Remove active class from all buttons and panes
                tabButtons.forEach(btn => btn.classList.remove('active'));
                tabPanes.forEach(pane => {
                    pane.classList.remove('show');
                    pane.classList.remove('active');
                });
                
                // Add active class to clicked button
                this.classList.add('active');
                
                // Get target pane and activate it
                const targetId = this.getAttribute('data-bs-target');
                const targetPane = document.querySelector(targetId);
                if (targetPane) {
                    targetPane.classList.add('show');
                    targetPane.classList.add('active');
                }
            });
        });
    });
</script>
{% endblock %}
