{% extends "base.html" %}

{% block title %}Edit Role - {{ role.name }}{% endblock %}

{% block header_title %}Edit Role{% endblock %}

{% block content %}
<div class="edit-role">
    <div class="card">
        <div class="card-header d-flex justify-content-between align-items-center">
            <h3>Edit Role: {{ role.name }}</h3>
            <a href="{{ url_for('manage_roles') }}" class="btn btn-sm btn-outline">
                <i class="fas fa-arrow-left"></i> Back to Roles
            </a>
        </div>
        <div class="card-body">
            <form method="POST">
                <div class="row">
                    <div class="col">
                        <div class="form-group">
                            <label for="name" class="form-label">Role Name</label>
                            <input type="text" id="name" name="name" class="form-control" 
                                   value="{{ role.name }}" required>
                        </div>
                    </div>
                    <div class="col">
                        <div class="form-group">
                            <label for="description" class="form-label">Description</label>
                            <input type="text" id="description" name="description" class="form-control"
                                   value="{{ role.description or '' }}">
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Permissions</label>
                    <div class="permissions-container" style="max-height: 400px; overflow-y: auto; padding: 1rem; border: 1px solid var(--gray-200); border-radius: 0.375rem;">
                        <div class="row">
                            <!-- User Management Permissions -->
                            <div class="col">
                                <h4 class="permission-category">User Management</h4>
                                <div class="permission-group">
                                    <div class="permission-item">
                                        <input type="checkbox" id="perm_users_view" name="permissions" value="users.view"
                                               {% if 'users.view' in role_permissions %}checked{% endif %}>
                                        <label for="perm_users_view" class="form-label mb-0">View Users</label>
                                    </div>
                                    <div class="permission-item">
                                        <input type="checkbox" id="perm_users_create" name="permissions" value="users.create"
                                               {% if 'users.create' in role_permissions %}checked{% endif %}>
                                        <label for="perm_users_create" class="form-label mb-0">Create Users</label>
                                    </div>
                                    <div class="permission-item">
                                        <input type="checkbox" id="perm_users_edit" name="permissions" value="users.edit"
                                               {% if 'users.edit' in role_permissions %}checked{% endif %}>
                                        <label for="perm_users_edit" class="form-label mb-0">Edit Users</label>
                                    </div>
                                    <div class="permission-item">
                                        <input type="checkbox" id="perm_users_delete" name="permissions" value="users.delete"
                                               {% if 'users.delete' in role_permissions %}checked{% endif %}>
                                        <label for="perm_users_delete" class="form-label mb-0">Delete Users</label>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Role Management Permissions -->
                            <div class="col">
                                <h4 class="permission-category">Role Management</h4>
                                <div class="permission-group">
                                    <div class="permission-item">
                                        <input type="checkbox" id="perm_roles_view" name="permissions" value="roles.view"
                                               {% if 'roles.view' in role_permissions %}checked{% endif %}>
                                        <label for="perm_roles_view" class="form-label mb-0">View Roles</label>
                                    </div>
                                    <div class="permission-item">
                                        <input type="checkbox" id="perm_roles_create" name="permissions" value="roles.create"
                                               {% if 'roles.create' in role_permissions %}checked{% endif %}>
                                        <label for="perm_roles_create" class="form-label mb-0">Create Roles</label>
                                    </div>
                                    <div class="permission-item">
                                        <input type="checkbox" id="perm_roles_edit" name="permissions" value="roles.edit"
                                               {% if 'roles.edit' in role_permissions %}checked{% endif %}>
                                        <label for="perm_roles_edit" class="form-label mb-0">Edit Roles</label>
                                    </div>
                                    <div class="permission-item">
                                        <input type="checkbox" id="perm_roles_delete" name="permissions" value="roles.delete"
                                               {% if 'roles.delete' in role_permissions %}checked{% endif %}>
                                        <label for="perm_roles_delete" class="form-label mb-0">Delete Roles</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row mt-3">
                            <!-- Site Management Permissions -->
                            <div class="col">
                                <h4 class="permission-category">Site Management</h4>
                                <div class="permission-group">
                                    <div class="permission-item">
                                        <input type="checkbox" id="perm_sites_view" name="permissions" value="sites.view"
                                               {% if 'sites.view' in role_permissions %}checked{% endif %}>
                                        <label for="perm_sites_view" class="form-label mb-0">View All Sites</label>
                                    </div>
                                    <div class="permission-item">
                                        <input type="checkbox" id="perm_sites_view_assigned" name="permissions" value="sites.view.assigned"
                                               {% if 'sites.view.assigned' in role_permissions %}checked{% endif %}>
                                        <label for="perm_sites_view_assigned" class="form-label mb-0">View Only Assigned Sites</label>
                                    </div>
                                    <div class="permission-item">
                                        <input type="checkbox" id="perm_sites_create" name="permissions" value="sites.create"
                                               {% if 'sites.create' in role_permissions %}checked{% endif %}>
                                        <label for="perm_sites_create" class="form-label mb-0">Create Sites</label>
                                    </div>
                                    <div class="permission-item">
                                        <input type="checkbox" id="perm_sites_edit" name="permissions" value="sites.edit"
                                               {% if 'sites.edit' in role_permissions %}checked{% endif %}>
                                        <label for="perm_sites_edit" class="form-label mb-0">Edit Sites</label>
                                    </div>
                                    <div class="permission-item">
                                        <input type="checkbox" id="perm_sites_delete" name="permissions" value="sites.delete"
                                               {% if 'sites.delete' in role_permissions %}checked{% endif %}>
                                        <label for="perm_sites_delete" class="form-label mb-0">Delete Sites</label>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Machine Management Permissions -->
                            <div class="col">
                                <h4 class="permission-category">Machine Management</h4>
                                <div class="permission-group">
                                    <div class="permission-item">
                                        <input type="checkbox" id="perm_machines_view" name="permissions" value="machines.view"
                                               {% if 'machines.view' in role_permissions %}checked{% endif %}>
                                        <label for="perm_machines_view" class="form-label mb-0">View Machines</label>
                                    </div>
                                    <div class="permission-item">
                                        <input type="checkbox" id="perm_machines_create" name="permissions" value="machines.create"
                                               {% if 'machines.create' in role_permissions %}checked{% endif %}>
                                        <label for="perm_machines_create" class="form-label mb-0">Create Machines</label>
                                    </div>
                                    <div class="permission-item">
                                        <input type="checkbox" id="perm_machines_edit" name="permissions" value="machines.edit"
                                               {% if 'machines.edit' in role_permissions %}checked{% endif %}>
                                        <label for="perm_machines_edit" class="form-label mb-0">Edit Machines</label>
                                    </div>
                                    <div class="permission-item">
                                        <input type="checkbox" id="perm_machines_delete" name="permissions" value="machines.delete"
                                               {% if 'machines.delete' in role_permissions %}checked{% endif %}>
                                        <label for="perm_machines_delete" class="form-label mb-0">Delete Machines</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row mt-3">
                            <!-- Part Management Permissions -->
                            <div class="col">
                                <h4 class="permission-category">Part Management</h4>
                                <div class="permission-group">
                                    <div class="permission-item">
                                        <input type="checkbox" id="perm_parts_view" name="permissions" value="parts.view"
                                               {% if 'parts.view' in role_permissions %}checked{% endif %}>
                                        <label for="perm_parts_view" class="form-label mb-0">View Parts</label>
                                    </div>
                                    <div class="permission-item">
                                        <input type="checkbox" id="perm_parts_create" name="permissions" value="parts.create"
                                               {% if 'parts.create' in role_permissions %}checked{% endif %}>
                                        <label for="perm_parts_create" class="form-label mb-0">Create Parts</label>
                                    </div>
                                    <div class="permission-item">
                                        <input type="checkbox" id="perm_parts_edit" name="permissions" value="parts.edit"
                                               {% if 'parts.edit' in role_permissions %}checked{% endif %}>
                                        <label for="perm_parts_edit" class="form-label mb-0">Edit Parts</label>
                                    </div>
                                    <div class="permission-item">
                                        <input type="checkbox" id="perm_parts_delete" name="permissions" value="parts.delete"
                                               {% if 'parts.delete' in role_permissions %}checked{% endif %}>
                                        <label for="perm_parts_delete" class="form-label mb-0">Delete Parts</label>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Maintenance Management Permissions -->
                            <div class="col">
                                <h4 class="permission-category">Maintenance Management</h4>
                                <div class="permission-group">
                                    <div class="permission-item">
                                        <input type="checkbox" id="perm_maintenance_view" name="permissions" value="maintenance.view"
                                               {% if 'maintenance.view' in role_permissions %}checked{% endif %}>
                                        <label for="perm_maintenance_view" class="form-label mb-0">View Maintenance</label>
                                    </div>
                                    <div class="permission-item">
                                        <input type="checkbox" id="perm_maintenance_schedule" name="permissions" value="maintenance.schedule"
                                               {% if 'maintenance.schedule' in role_permissions %}checked{% endif %}>
                                        <label for="perm_maintenance_schedule" class="form-label mb-0">Schedule Maintenance</label>
                                    </div>
                                    <div class="permission-item">
                                        <input type="checkbox" id="perm_maintenance_record" name="permissions" value="maintenance.record"
                                               {% if 'maintenance.record' in role_permissions %}checked{% endif %}>
                                        <label for="perm_maintenance_record" class="form-label mb-0">Record Maintenance</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row mt-3">
                            <!-- Backup Management Permissions -->
                            <div class="col">
                                <h4 class="permission-category">Backup Management</h4>
                                <div class="permission-group">
                                    <div class="permission-item">
                                        <input type="checkbox" id="perm_backup_view" name="permissions" value="backup.view"
                                               {% if 'backup.view' in role_permissions %}checked{% endif %}>
                                        <label for="perm_backup_view" class="form-label mb-0">View Backups</label>
                                    </div>
                                    <div class="permission-item">
                                        <input type="checkbox" id="perm_backup_create" name="permissions" value="backup.create"
                                               {% if 'backup.create' in role_permissions %}checked{% endif %}>
                                        <label for="perm_backup_create" class="form-label mb-0">Create Backups</label>
                                    </div>
                                    <div class="permission-item">
                                        <input type="checkbox" id="perm_backup_restore" name="permissions" value="backup.restore"
                                               {% if 'backup.restore' in role_permissions %}checked{% endif %}>
                                        <label for="perm_backup_restore" class="form-label mb-0">Restore Backups</label>
                                    </div>
                                    <div class="permission-item">
                                        <input type="checkbox" id="perm_backup_delete" name="permissions" value="backup.delete"
                                               {% if 'backup.delete' in role_permissions %}checked{% endif %}>
                                        <label for="perm_backup_delete" class="form-label mb-0">Delete Backups</label>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Administration Permissions -->
                            <div class="col">
                                <h4 class="permission-category">Administration</h4>
                                <div class="permission-group">
                                    <div class="permission-item">
                                        <input type="checkbox" id="perm_admin_access" name="permissions" value="admin.access"
                                               {% if 'admin.access' in role_permissions %}checked{% endif %}>
                                        <label for="perm_admin_access" class="form-label mb-0">Admin Panel Access</label>
                                    </div>
                                    <div class="permission-item">
                                        <input type="checkbox" id="perm_admin_full" name="permissions" value="admin.full"
                                               {% if 'admin.full' in role_permissions %}checked{% endif %}>
                                        <label for="perm_admin_full" class="form-label mb-0">Full Administrative Access</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="d-flex gap-2 mt-4">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Save Changes
                    </button>
                    <a href="{{ url_for('manage_roles') }}" class="btn btn-secondary">
                        <i class="fas fa-times"></i> Cancel
                    </a>
                </div>
            </form>
        </div>
    </div>
</div>

<style>
    .permission-category {
        font-size: 1rem;
        font-weight: 600;
        color: var(--gray-700);
        margin-bottom: 0.75rem;
        padding-bottom: 0.25rem;
        border-bottom: 1px solid var(--gray-200);
    }
    
    .permission-group {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
    }
    
    .permission-item {
        display: flex;
        align-items: center;
        margin-bottom: 0.25rem;
    }
    
    .permission-item input[type="checkbox"] {
        margin-right: 0.5rem;
    }
</style>
{% endblock %}
